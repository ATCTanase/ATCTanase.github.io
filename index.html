<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>DWAI</title>
  <link rel="icon" href="TemplateData/favicons/favicon.png">
  <link rel="stylesheet" href="TemplateData/style.css">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-orientation" content="landscape">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: black;
    }

    #unity-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: black;
    }

    #unity-container canvas {
      position: absolute;
      transform-origin: center center;
      display: block;
      top: 50%;
      left: 50%;
    }

    #unity-loading-bar {
      position: absolute;
      width: 100%;
      height: 4px;
      background: #222;
      top: 0;
      left: 0;
    }

    #unity-progress-bar-full {
      height: 100%;
      width: 0;
      background: #29e;
    }

    #unity-warning { position: absolute; top: 0; left: 0; width: 100%; }
  </style>
</head>
<body>
  <div id="unity-container">
    <canvas id="unity-canvas" tabindex="-1"></canvas>
    <div id="unity-loading-bar">
      <div id="unity-progress-bar-full"></div>
    </div>
    <div id="unity-warning"></div>
  </div>

  <script>
    function resizeUnityCanvas() {
      const container = document.getElementById("unity-container");
      const canvas = container.querySelector("canvas");
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;
let maxCanvasHeight = screenWidth; // 回転後の高さ
let maxCanvasWidth = screenHeight; // 回転後の幅
      const gameRatio = 16 / 9;

      let canvasWidth, canvasHeight;

      if(screenHeight > screenWidth){
        // 縦画面 → 横画面固定
        const rotatedWidth = screenHeight;
        const rotatedHeight = screenWidth;

if(maxCanvasWidth / maxCanvasHeight > gameRatio){
    canvasHeight = maxCanvasHeight;
    canvasWidth = canvasHeight * gameRatio;
} else {
    canvasWidth = maxCanvasWidth;
    canvasHeight = canvasWidth / gameRatio;
}

// 内部解像度とCSSサイズを一致
canvas.width = canvasWidth;
canvas.height = canvasHeight;
canvas.style.width = canvasWidth + "px";
canvas.style.height = canvasHeight + "px";

// 中央配置・回転
canvas.style.transform = "translate(-50%, -50%) rotate(90deg)";
canvas.style.transformOrigin = "center center";
canvas.style.top = "50%";
canvas.style.left = "50%";
      } else {
        // 横画面
        if(screenWidth / screenHeight > gameRatio){
          canvasHeight = screenHeight;
          canvasWidth = canvasHeight * gameRatio;
        } else {
          canvasWidth = screenWidth;
          canvasHeight = canvasWidth / gameRatio;
        }

        canvas.style.width = canvasWidth + "px";
        canvas.style.height = canvasHeight + "px";
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        canvas.style.transform = "translate(-50%, -50%)";
      }

      canvas.style.top = "50%";
      canvas.style.left = "50%";
      canvas.style.transformOrigin = "center center";
    }

    window.addEventListener("load", resizeUnityCanvas);
    window.addEventListener("resize", resizeUnityCanvas);

    // Unity WebGL ローダー部分
    var buildUrl = "Build";
    var loaderUrl = buildUrl + "/2e7a7585d31d2355062dc8b2c9eee5de.loader.js";
    var config = {
      dataUrl: buildUrl + "/556c29c816e3bca6efa88b04c6555107.data.unityweb",
      frameworkUrl: buildUrl + "/af645531fdb524daee5d0b26e663c345.framework.js.unityweb",
      codeUrl: buildUrl + "/b3cc8a9d006e801e593859c02a396c29.wasm.unityweb",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "workhappiness",
      productName: "DWAI",
      productVersion: "1.0",
      showBanner: function(msg,type){
        const warning = document.getElementById("unity-warning");
        const div = document.createElement("div");
        div.innerHTML = msg;
        if(type==='error') div.style = 'background:red;padding:10px;';
        else if(type==='warning') div.style='background:yellow;padding:10px;';
        warning.appendChild(div);
        setTimeout(()=>{warning.removeChild(div);},5000);
      }
    };

    var canvas = document.getElementById("unity-canvas");
    var loadingBarFull = document.getElementById("unity-progress-bar-full");
    var script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      createUnityInstance(canvas, config, (progress) => {
        loadingBarFull.style.width = 100*progress + "%";
      }).then((unityInstance) => {
        document.getElementById("unity-loading-bar").style.display = "none";
      }).catch(alert);
    };
    document.body.appendChild(script);
  </script>
</body>
</html>


