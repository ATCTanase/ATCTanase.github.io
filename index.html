<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>DWAI</title>
<link rel="icon" href="TemplateData/favicons/favicon.png">
<link rel="stylesheet" href="TemplateData/style.css">
<link rel="manifest" href="manifest.webmanifest">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-orientation" content="landscape">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
html, body {
  margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:black;
}
#unity-canvas {
  position:absolute;
  top:50%;
  left:50%;
  transform-origin:center center;
  display:block;
}
</style>

<script>
// Canvas 横画面固定
function resizeCanvas() {
  const canvas = document.getElementById("unity-canvas");
  const screenWidth = window.innerWidth;
  const screenHeight = window.innerHeight;
  const gameRatio = 16/9;

  let canvasWidth, canvasHeight;

  if(screenHeight > screenWidth){
    canvasWidth = screenWidth;
    canvasHeight = canvasWidth / gameRatio;
    if(canvasHeight > screenHeight){
      canvasHeight = screenHeight;
      canvasWidth = canvasHeight * gameRatio;
    }
    canvas.style.transform = `translate(-50%, -50%) rotate(90deg)`;
  } else {
    if(screenWidth / screenHeight > gameRatio){
      canvasHeight = screenHeight;
      canvasWidth = canvasHeight * gameRatio;
    } else {
      canvasWidth = screenWidth;
      canvasHeight = canvasWidth / gameRatio;
    }
    canvas.style.transform = `translate(-50%, -50%)`;
  }

  canvas.style.width = canvasWidth + "px";
  canvas.style.height = canvasHeight + "px";
  canvas.width = canvasWidth;
  canvas.height = canvasHeight;
  canvas.style.top = "50%";
  canvas.style.left = "50%";

  if(screen.orientation && screen.orientation.lock){
    screen.orientation.lock("landscape").catch(err=>console.warn(err));
  }
}

// 初回ロード＆リサイズ対応
window.addEventListener("load", resizeCanvas);
window.addEventListener("resize", resizeCanvas);
</script>
</head>

<body>
<div id="unity-container">
  <canvas id="unity-canvas" width="1280" height="800" tabindex="-1"></canvas>
  <div id="unity-loading-bar">
    <div id="unity-logo"></div>
    <div id="unity-progress-bar-empty">
      <div id="unity-progress-bar-full"></div>
    </div>
  </div>
  <div id="unity-warning"></div>
</div>

<script>
window.addEventListener("load", function () {
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("ServiceWorker.js");
  }
});

var canvas = document.querySelector("#unity-canvas");
var loadingBar = document.querySelector("#unity-loading-bar");
var progressBarFull = document.querySelector("#unity-progress-bar-full");
var warningBanner = document.querySelector("#unity-warning");

function unityShowBanner(msg, type) {
  function updateBannerVisibility() {
    warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
  }
  var div = document.createElement('div');
  div.innerHTML = msg;
  warningBanner.appendChild(div);
  if(type == 'error') div.style = 'background: red; padding: 10px;';
  else if(type == 'warning') div.style = 'background: yellow; padding: 10px;';
  setTimeout(() => { warningBanner.removeChild(div); updateBannerVisibility(); }, 5000);
  updateBannerVisibility();
}

var buildUrl = "Build";
var loaderUrl = buildUrl + "/2e7a7585d31d2355062dc8b2c9eee5de.loader.js";
var config = {
  arguments: [],
  dataUrl: buildUrl + "/556c29c816e3bca6efa88b04c6555107.data.unityweb",
  frameworkUrl: buildUrl + "/af645531fdb524daee5d0b26e663c345.framework.js.unityweb",
  codeUrl: buildUrl + "/b3cc8a9d006e801e593859c02a396c29.wasm.unityweb",
  streamingAssetsUrl: "StreamingAssets",
  companyName: "workhappiness",
  productName: "DWAI",
  productVersion: "1.0",
  showBanner: unityShowBanner
};

if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){
  var meta = document.createElement('meta');
  meta.name = 'viewport';
  meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
  document.getElementsByTagName('head')[0].appendChild(meta);
}

loadingBar.style.display = "block";

var script = document.createElement("script");
script.src = loaderUrl;
script.onload = () => {
  createUnityInstance(canvas, config, (progress) => {
    progressBarFull.style.width = 100 * progress + "%";
  }).then((unityInstance) => {
    loadingBar.style.display = "none";
  }).catch((message) => { alert(message); });
};
document.body.appendChild(script);
</script>

</body>
</html>
